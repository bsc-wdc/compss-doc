\section{Supercomputers}
\label{sec:Supercomputers}

The COMPSs Framework can be installed in any Supercomputer by installing its packages as in a normal distribution. The packages are
ready to be reallocated so the administrators can choose the right location for the COMPSs installation. \newline

However, if the administrators are not willing to install COMPSs through the packaging system, we also provide a \textbf{COMPSs 
zipped file} containing a pre-build script to easily install COMPSs. Next subsections provide further information about this process.

\subsection{Prerequisites}
In order to successfully run the installation script some dependencies must be present on the target machine. Administrators must 
provide the correct installation and environment of the following software:
\begin{itemize}
 \item Autotools
 \item BOOST
 \item Java 7 JRE
\end{itemize}

The following environment variables must be defined:
\begin{itemize}
 \item $JAVA\_HOME$
 \item $BOOST\_CPPFLAGS$
\end{itemize}

The tracing system can be enhanced with:
\begin{itemize}
 \item PAPI, which provides support for harware counters
 \item MPI, which speeds up the tracing merge (and enables it for huge traces)
\end{itemize}


\subsection{Installation}
To perform the COMPSs Framework installation please execute the following commands:
\begin{lstlisting}[language=bash]
 # Check out the last COMPSs release
 $ wget http://compss.bsc.es/repo/sc/stable/COMPSs_1.3.tar.gz

 # Unpackage COMPSs
 $ tar -xvzf COMPSs_1.3.tar.gz
 
 # Install COMPSs at your preferred target location
 $ cd COMPSs
 $ ./install <targetDir>
 
 # Clean downloaded files
 $ rm -r COMPSs
 $ rm COMPSs_1.3.tar.gz
\end{lstlisting}

The installation script will create a COMPSs folder inside the given $<targetDir>$ so the final COMPSs installation will be placed 
under the $<targetDir>/COMPSs$ folder. Please note that if the folder already exists it will be \textbf{automatically erased}.

~ \newline
After completing the previous steps, administrators must ensure that the nodes have passwordless ssh access. If it is not the case,
please contact the COMPSs team at $support-compss@bsc.es$.

~ \newline
The COMPSs package also provides a \textit{compssenv} file that loads the required environment to allow users work more easily
with COMPSs. Thus, after the installation process we recomend to source the $<targetDir>/COMPSs/compssenv$ into the 
users \textit{.bashrc}.

~ \newline
Once done, remember to log out and back in again to end the installation process.

\subsection{Post installation}
To check that COMPSs Framework has been successfully installed you may run:
\begin{lstlisting}[language=bash]
 # Check the COMPSs version
 $ runcompss -v
 COMPSs version 1.3
\end{lstlisting}

For queue system executions, COMPSs provides several prebuild queue scripts than can be accessible throgh the \textit{enqueue\_compss}
command. Users can check the available options by running:
\begin{lstlisting}[language=bash]
$ enqueue_compss --help
Usage: /apps/COMPSs/1.3/Runtime/scripts/user/enqueue_compss 
         [queue_system_options] [COMPSs_options] 
         application_name application_arguments

* Options:
  General:
    --help, -h                              Print this help message
  
  Queue system configuration:
    - -exec_time=<minutes>                  Expected execution time of 
                                            the application (in minutes)
                                            Default: 10
                                            
    - -num_nodes=<int>                      Number of nodes to use
                                            Default: 2
                                            
    - -num_switches=<int>                   Maximum number of different switches.
                                            Select 0 for no restrictions.
                                            Maximum nodes per switch: 18
                                            Only available for at least 4 nodes. 
                                            Default: 0 
                                            
    - -queue_system=<name>                  Queue system to use: lsf | pbs | slurm
                                            Default: lsf
    - -queue=<name>                         Queue name to submit the job. 
                                            Depends on the queue system.
                                            For example (MN3): bsc_cs | bsc_debug
                                                | debug | interactive
                                            Default: default
                                            
    - -job_dependency=<jobID>               Postpone job execution until the job
                                            dependency has ended.
                                            Default: None
                                            
    - -tasks_per_node=<int>                 Maximum number of simultaneous
                                            tasks running on a node
                                            Default: 16
                                            
    - -master_working_dir=<path>            Working directory of the application
                                            Default: .
                                            
    - -worker_working_dir=<name>            Worker directory. Use: scratch | gpfs
                                            Default: scratch
                                            
    - -tasks_in_master=<int>                Maximum number of tasks that the master
                                            node can run as worker. Cannot exceed 
                                            tasks_per_node.
                                            Default: 0
                                            
    - -network=<name>                       Communication network for transfers:
                                            default | ethernet | infiniband | data.
                                            Default: infiniband
          
          
  Runcompss delegated parameters:

  Tools enablers:
    - -graph=<bool>, - -graph, -g           Generation of the complete graph (true/false)
                                            When no value is provided it is set to true
                                            Default: false
                                            
    - -tracing=<bool>, - -tracing, -t       Generation of traces (true/false)
                                            When no value is provided it is set to true
                                            Default: false
                                            
    - -monitoring=<int>, - -monitoring, -m  Period between monitoring samples 
                                            (milliseconds)
                                            When no value is provided it is set to 2000
                                            Default: 0
                                            
  Runtime configuration options:
    - -project=<path>                       Path to the project XML file
                                            Default: /gpfs/apps/MN3/COMPSs/1.3/Runtime/
                                            configuration/xml/projects/project.xml
                                            
    - -resources=<path>                     Path to the resources XML file
                                            Default: /gpfs/apps/MN3/COMPSs/1.3/Runtime/
                                            configuration/xml/resources/resources.xml
                                            
    - -lang=<name>                          Language of the application (java/c/python)
                                            Default: java
                                            
    - -log_level=<level>, - -debug, -d      Set the debug level: off | info | debug
                                            Default: off
  Advanced options:
    - -comm=<path>                          Class that implements the adaptor 
                                            for communications
                                            Supported adaptors: 
                                            integratedtoolkit.nio.master.NIOAdaptor | 
                                            integratedtoolkit.gat.master.GATAdaptor
                                            Default: 
                                              integratedtoolkit.nio.master.NIOAdaptor
                                              
    - -library_path=<path>                  Non-standard directories to search 
                                            for libraries (e.g. Java JVM library, 
                                            Python library, C binding library) 
                                            Default: Working Directory
                                            
    - -classpath=<path>                     Path for the application classes / modules
                                            Default: Working Directory
                                            
    - -task_count=<int>                     Only for C/Python Bindings. Maximum number
                                            of different functions/methods, invoked
                                            from the application, that have been
                                            selected as tasks
                                            Default: 50
                                            
    - -uuid=<int>                           Preset an application UUID
                                            Default: Automatic random generation
                                            
    - -PyObject_conversion=<bool>           Only for Python Binding. Enable the object
                                            conversion to string when possible
                                            (true/false).
                                            Default: false
                                            
* Application name:
    For Java applications:   Fully qualified name of the application
    For C applications:      Path to the master binary
    For Python applications: Path to the .py file containing the main program
    
* Application arguments:
    Command line arguments to pass to the application. Can be empty. 
                                            
\end{lstlisting}

If none of the pre-build sub-queue scripts adapts to your infrastructure (lsf, pbs, slurm, etc.) please contact 
the COMPSs team at $support-compss@bsc.es$ to find out a solution.

~ \newline
If you are willing to test the COMPSs Framework installation you can run any of the applications available at our application 
repository \url{https://compss.bsc.es/projects/bar}. We suggest to run the java simple application following the steps listed
inside its \textit{README} file. 

~ \newline
For further information about either the installation or the usage please check the \textit{README} file inside the COMPSs package. 

